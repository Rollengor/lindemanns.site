<?php

namespace App\Http\Controllers\Public;

use App\Http\Controllers\Controller;
use App\Models\NewsArticle;
use App\Models\NewsCategory;
use App\Models\Page;
use App\Models\Project;
use App\Models\ServiceCategory;
use App\Models\SiteSection;
use Illuminate\Http\Request;
use Illuminate\View\View;

class HomePageController extends Controller
{
    public function index(): View {
        $page = Page::where('slug', 'home')->first();
        $serviceCategories = ServiceCategory::whereHas('services', function ($query) {
            $query->where('active', 1);
        })->with(['services' => function ($query) {
            $query->where('active', 1)->orderByDesc('sort');
        }])->where('active', 1)->orderByDesc('sort')->get();
        $projects = Project::where('active', 1)->latest()->orderByDesc('sort')->limit(4)->get();
        $newsCategories = NewsCategory::where('active', '1')->get();
        $newsArticles = NewsArticle::where('active', '1')->latest()->orderByDesc('sort')->limit(6)->get();
        $whoWeAreSection = SiteSection::where('slug', 'who-we-are')->first();
        $contactUsSection = SiteSection::where('slug', 'contact-us')->first();

        return view('public.pages.home', compact('page', 'serviceCategories', 'projects', 'newsCategories', 'newsArticles', 'whoWeAreSection', 'contactUsSection'));
    }
}
